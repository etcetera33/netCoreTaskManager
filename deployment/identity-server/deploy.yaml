apiVersion: apps/v1beta1
kind: Deployment
metadata:
    name: identity-server
spec:
    replicas: 1
    template:
        metadata:
            labels:
                app: identity-server
        spec:
            containers:
              - name: identity-server
                image: dapoliit.azurecr.io/identity-server:latest
                ports:
                    - containerPort: 80
                env:
                    - name: ConnectionStrings__DefaultConnection
                      valueFrom:
                        secretKeyRef:
                          name: dev-config
                          key: ConnectionStrings__DefaultConnection
                    - name: Redis__ConnectionString
                      value: redis-master:6379,connectRetry=5
                    - name: RabbitMqConfig__Host
                      value: "rabbitmq"
                    - name: RabbitMqConfig__Username
                      value: "usr"
                    - name: RabbitMqConfig__Password
                      valueFrom:
                        secretKeyRef:
                          name: dev-config
                          key: RabbitMqConfig__Password
                    - name: RabbitMqConfig__SSLActive
                      value: "false"
                    - name: Authorization__Issuer
                      value: "http://identity-server:9000"
                    #- name: Authentication
                    #  valueFrom:
                    #    configMapKeyRef:
                    #      name: identity-server-configmap
                    #      key: config.json
                volumeMounts:
                  - name: identity-server-configmap
                    mountPath: /app/config
            volumes:
              - name: identity-server-configmap
                configMap:
                  name: identity-server-configmap
            imagePullSecrets:
                - name: azure-ad-secret